#!/bin/bash

#SBATCH -J siggame
#SBATCH -N 1
#SBATCH -c 4
#SBATCH --ntasks=1
#SBATCH --ntasks-per-node=1
#SBATCH --time=18:00:00
#SBATCH --mem=12GB
#SBATCH --partition=gpu
#SBATCH --gres=gpu:1
#SBATCH -C quadrortx

#SBATCH --array=1-7
#SBATCH -o job_outputs_ph/siggame_ph_job_%j.o
#SBATCH -e job_outputs_ph/siggame_ph_job_%j.e
#SBATCH --mail-type=END
#SBATCH --mail-user=benjamin_spiegel@brown.edu

echo $LD_LIBRARY_PATH
unset LD_LIBRARY_PATH
echo $LD_LIBRARY_PATH

export HYDRA_FULL_ERROR=1
# export JAX_DEBUG_NANS=True

source /oscar/home/bspiegel/envs/jax.venv/bin/activate
cd /oscar/home/bspiegel/signification-game/base_experiment/


########################################################################
########################################################################
##################### Fall 2025  Starts Below ##########################
########################################################################
########################################################################



#### For collecting listeners to run ToM experiments on cifar20
# python3 -u ippo_ff.py WANDB_NOTES="Fall-2025 cifar20 just listeners punish even less 3.5k epochs" +dataset=cifar20 ENV_KWARGS.channel_ratio_fn="0.0" SPEAKER_TRAIN_SCHEDULE="off" UPDATE_EPOCHS=3500 ENV_NUM_DATAPOINTS=5000 ENV_KWARGS.listener_reward_success=5.0 ENV_KWARGS.listener_reward_failure=-0.01 ENV_KWARGS.channel_ratio_fn=0.0 ENV_KWARGS.speaker_referent_span_fn=20 WANDB_MODE=online PICKLE_FINAL_AGENTS=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar20 just listeners 5k epochs" +dataset=cifar20 ENV_KWARGS.channel_ratio_fn="0.0" SPEAKER_TRAIN_SCHEDULE="off" UPDATE_EPOCHS=5000 ENV_NUM_DATAPOINTS=5000 ENV_KWARGS.listener_reward_success=1.0 ENV_KWARGS.listener_reward_failure=-0.01 WANDB_MODE=online PICKLE_FINAL_AGENTS=True

#### For testing various listener architectures for the phonology study
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv baseline" +dataset=cifar10b LISTENER_ARCH="conv" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 5e-6 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv baseline" +dataset=cifar10b LISTENER_ARCH="conv" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 1e-5 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True

# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener dense" +dataset=cifar10b LISTENER_ARCH="dense" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 5e-6 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv-bottleneck" +dataset=cifar10b LISTENER_ARCH="conv-bottleneck-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 5e-6 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv-largekernel" +dataset=cifar10b LISTENER_ARCH="conv-largekernel-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 5e-6 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv-strided" +dataset=cifar10b LISTENER_ARCH="conv-strided-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 5e-6 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv-strongembed" +dataset=cifar10b LISTENER_ARCH="conv-strongembed-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 5e-6 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv-weakembed" +dataset=cifar10b LISTENER_ARCH="conv-weakembed-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 5e-6 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True

# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv-high-features" +dataset=cifar10b LISTENER_ARCH="conv-high-features-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 1e-5 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv-low-features" +dataset=cifar10b LISTENER_ARCH="conv-low-features-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 1e-5 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv-high-embed" +dataset=cifar10b LISTENER_ARCH="conv-high-embed-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 1e-5 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv-low-embed" +dataset=cifar10b LISTENER_ARCH="conv-low-embed-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 1e-5 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv-less-conv" +dataset=cifar10b LISTENER_ARCH="conv-less-conv-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 1e-5 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv-less-embed" +dataset=cifar10b LISTENER_ARCH="conv-less-embed-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 1e-5 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv-strongembed" +dataset=cifar10b LISTENER_ARCH="conv-strongembed-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 5e-6 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv-weakembed" +dataset=cifar10b LISTENER_ARCH="conv-weakembed-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 5e-6 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True


# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep listener conv-less-embed" +dataset=cifar10b LISTENER_ARCH="conv-less-embed-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 1e-5 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True

# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep 2 splines listener conv-high-features" +dataset=cifar10b LISTENER_ARCH="conv-high-features-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=14 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 1e-5 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep 2 splines listener conv-low-features" +dataset=cifar10b LISTENER_ARCH="conv-low-features-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=14 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 1e-5 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep 2 splines listener conv-high-embed" +dataset=cifar10b LISTENER_ARCH="conv-high-embed-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=14 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 1e-5 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep 2 splines listener conv-low-embed" +dataset=cifar10b LISTENER_ARCH="conv-low-embed-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=14 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 1e-5 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep 2 splines listener conv-less-conv" +dataset=cifar10b LISTENER_ARCH="conv-less-conv-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=14 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 1e-5 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep 2 splines listener conv-less-embed" +dataset=cifar10b LISTENER_ARCH="conv-less-embed-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=14 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 1e-5 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep 2 splines listener conv-strongembed" +dataset=cifar10b LISTENER_ARCH="conv-strongembed-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=14 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 5e-6 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True
# python3 -u ippo_ff.py WANDB_NOTES="cifar10b phonology sweep 2 splines listener conv-weakembed" +dataset=cifar10b LISTENER_ARCH="conv-weakembed-1" ENV_KWARGS.channel_ratio_fn="0.0 jump to 0.8 at 2000" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=14 ENV_KWARGS.speaker_assignment_method="random" ENV_KWARGS.agent_inferential_mode_fn="1.0" LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE="1e-4 jump to 5e-6 at 2000" SPEAKER_LR_SCHEDULE="1e-4" SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=4000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True

# python3 -u ippo_ff.py WANDB_NOTES="cifar10b speaker 2 splines listener conv heatmap test ch 1" +dataset=cifar10b LISTENER_ARCH=conv ENV_KWARGS.speaker_action_transform=splines_weight ENV_KWARGS.channel_ratio_fn="1.0" ENV_KWARGS.speaker_curve_penalty_coef=0.0 ENV_KWARGS.speaker_whitesum_penalty_coef=0.0 ENV_KWARGS.speaker_action_dim=14 ENV_KWARGS.speaker_assignment_method=random ENV_KWARGS.agent_inferential_mode_fn=1.0 LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 L2_REG_COEF_SPEAKER=1e-2 LISTENER_LR_SCHEDULE=1e-5 SPEAKER_LR_SCHEDULE=1e-4 SPEAKER_TRAIN_SCHEDULE=on UPDATE_EPOCHS=2000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True PRETRAINED_LISTENERS=agents-cifar10b-woven-glade-2275-2000e-5000dp-c6fb

########################################################################
################### Full Phonology Sweep Below #########################
########################################################################



#### Full Sweep

# PARAMS=$(sed -n "$((SLURM_ARRAY_TASK_ID))p" batch_scripts/sweep_params/sweep_phones_params_25.txt)
# PARAMS=$(sed -n "$((SLURM_ARRAY_TASK_ID))p" batch_scripts/sweep_params/sweep_phones_params_50.txt)
# echo $PARAMS
# There are 35 of these

## cifar10b, no pretraining, 2 splines
# python3 -u ippo_ff.py WANDB_NOTES="phonology sweep cifar10b no pretraining 2 splines" PROJECT="phonology-study" +dataset=cifar10b ENV_KWARGS.channel_ratio_fn="1.0" ENV_KWARGS.speaker_action_dim=14 ENV_KWARGS.agent_inferential_mode_fn=1.0 LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 LISTENER_LR_SCHEDULE=1e-5 SPEAKER_LR_SCHEDULE=1e-4 SPEAKER_TRAIN_SCHEDULE=on UPDATE_EPOCHS=3000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True PRETRAINED_LISTENERS="" $PARAMS

## cifar10b, no pretraining, 3 splines
# python3 -u ippo_ff.py WANDB_NOTES="phonology sweep cifar10b no pretraining 3 splines" PROJECT="phonology-study" +dataset=cifar10b ENV_KWARGS.channel_ratio_fn="1.0" ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.agent_inferential_mode_fn=1.0 LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 LISTENER_LR_SCHEDULE=1e-5 SPEAKER_LR_SCHEDULE=1e-4 SPEAKER_TRAIN_SCHEDULE=on UPDATE_EPOCHS=3000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True PRETRAINED_LISTENERS="" $PARAMS

## cifar10b, 250 epoch pretraining, 2 splines
# python3 -u ippo_ff.py WANDB_NOTES="phonology sweep cifar10b 250 epoch pretraining 2 splines" PROJECT="phonology-study" +dataset=cifar10b ENV_KWARGS.channel_ratio_fn="0.0 jump to 1.0 at 250" ENV_KWARGS.speaker_action_dim=14 ENV_KWARGS.agent_inferential_mode_fn=1.0 LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 LISTENER_LR_SCHEDULE=1e-5 SPEAKER_LR_SCHEDULE=1e-4 SPEAKER_TRAIN_SCHEDULE="off then on at 250" UPDATE_EPOCHS=3250 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True PRETRAINED_LISTENERS="" $PARAMS

# ## cifar10b, 250 epoch pretraining, 3 splines
# python3 -u ippo_ff.py WANDB_NOTES="phonology sweep cifar10b 250 epoch pretraining 3 splines" PROJECT="phonology-study" +dataset=cifar10b ENV_KWARGS.channel_ratio_fn="0.0 jump to 1.0 at 250" ENV_KWARGS.speaker_action_dim=21 ENV_KWARGS.agent_inferential_mode_fn=1.0 LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 LISTENER_LR_SCHEDULE=1e-5 SPEAKER_LR_SCHEDULE=1e-4 SPEAKER_TRAIN_SCHEDULE="off then on at 250" UPDATE_EPOCHS=3250 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=False LOG_TOM_SPEAKER_EXAMPLES=True PRETRAINED_LISTENERS="" $PARAMS


#### Listener Pretraining

# PARAMS=$(sed -n "$((SLURM_ARRAY_TASK_ID))p" batch_scripts/sweep_params/sweep_phones_listener_pretrain_25.txt)
PARAMS=$(sed -n "$((SLURM_ARRAY_TASK_ID))p" batch_scripts/sweep_params/sweep_phones_listener_pretrain_50.txt)
# echo $PARAMS
# There are 7 of these

## cifar10b, 2000 epoch just pretraining to save
python3 -u ippo_ff.py WANDB_NOTES="cifar10b 2000 epoch just pretraining" PROJECT="phonology-study" +dataset=cifar10b ENV_KWARGS.channel_ratio_fn="0.0 jump to 1.0 at 2000" ENV_KWARGS.speaker_action_dim=14 ENV_KWARGS.agent_inferential_mode_fn=1.0 LISTENER_N_SAMPLES=6 SPEAKER_N_SEARCH=2 MAX_SPEAKER_N_SEARCH=2 LISTENER_PR_WEIGHT=1.0 LISTENER_LR_SCHEDULE=1e-5 SPEAKER_LR_SCHEDULE=1e-4 SPEAKER_TRAIN_SCHEDULE="off then on at 2000" UPDATE_EPOCHS=2000 ENV_NUM_DATAPOINTS=5000 WANDB_MODE=online PICKLE_FINAL_AGENTS=True LOG_TOM_SPEAKER_EXAMPLES=True PRETRAINED_LISTENERS="" $PARAMS


## Pre-trained listener agent models below
# for cifar10: "agents-cifar10-peach-spaceship-2253-2000e-5000dp-0fea"
# for cifar10b: "agents-cifar10b-woven-glade-2275-2000e-5000dp-c6fb"
# for cifar20: "agents-cifar20-jolly-dawn-2614-3500e-5000dp-5231"
